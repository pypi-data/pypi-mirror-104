{% extends "exoral/base.html" %}

{% load static sekizai_tags %}

{% block js %}
{% addtoblock "js" %}
<script src="{% static 'js/helpers.js' %}"></script>
<script charset="utf-8" type="text/javascript">
  function setup() {
    $("#suchfeld").keyup(function() {
      var v = $(this).val();
      if (v == '') {
        $(".frage").show();
      } else {
        filter(".fragentext", v, elem => $(elem).parents('.frage').show(), elem => $(elem).parents('.frage').hide());
      }
    });
  }

  $(document).ready(setup);
</script>
{% endaddtoblock %}
{% endblock %}

{% block content %}
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item" aria-current="page"><a href="{% url 'exoral:home' %}">Testate</a></li>
      <li class="breadcrumb-item" aria-current="page"><a href="{% url 'exoral:testat-detail' testat.pk %}">{{ testat }}</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{ pruefer }}</li>
      <li class="breadcrumb-item" aria-current="page">
        <a href="{% url 'exoral:frage-create' testat.pk pruefer.pk %}">neue Frage hinzufügen</a>
      </li>
    </ol>
  </nav>

  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="suche"><img src="{% static "img/icons/search.svg" %}"></span>
    </div>
    <input type="text" id="suchfeld" class="form-control" placeholder="Tippe zum Filtern" aria-label="Suche">
  </div>

  {% if not user.is_staff %}
  {% if perms.exoral.change_frage or perms.exoral.delete_frage %}
  <div class="alert alert-danger" role="alert">
  Problem: du darfst Fragen bearbeiten und löschen, aber du hast nicht den <em>Mitarbeiterstatus</em>.
  Ohne den kannst du aber nicht im Adminbereich arbeiten.
  Bitte lass dir von einem Administrator den Mitarbeiterstatus geben.
  </div>
  {% endif %}
  {% endif %}

  {% for frage in fragen %}
  <div class="card mb-2 frage">
    <div class="card-body">
      <div class="row">
        <div class="col">
          <small class="text-muted">{{ frage.datum }}</small>
        </div>
        <div class="col">
          {% if user.is_staff %}
          {% if perms.exoral.change_frage %}
          <small><a href="{% url 'admin:exoral_frage_change' frage.id %}" target="_blank">im Admin-Panel bearbeiten</a></small>
          {% endif %}
          {% if perms.exoral.delete_frage %}
          <small><a href="{% url 'admin:exoral_frage_delete' frage.id %}" target="_blank" class="text-danger">Löschen</a></small>
          {% endif %}
          {% endif %}
        </div>
        <div class="col text-right">
          <small>Score: {{ frage.punkte }}</small>
          {% if not frage.abgestimmt %}
          <a href="{% url 'exoral:upvote-frage' frage.pk %}"><img src="{% static "img/icons/plus-square.svg" %}"></a>
          {% else %}
          <a href="{% url 'exoral:downvote-frage' frage.pk %}"><img src="{% static "img/icons/dash-square.svg" %}"></a>
          {% endif %}
        </div>
      </div>
      <p class="card-text fragentext">{{ frage.text }}</p>

      {% if frage.antwort %}
      <a data-toggle="collapse" href="#antwort_{{ frage.pk }}" role="button" aria-expanded="false">Antwort</a>
      <div class="collapse" id="antwort_{{ frage.pk }}">
        <p>{{ frage.antwort }}</p>
      </div>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <p>
    Keine Fragen vorhanden.
  </p>
  {% endfor %}
</div>
{% endblock content %}
